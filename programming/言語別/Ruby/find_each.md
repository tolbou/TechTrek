## find_each

**`find_each`** メソッドは、Ruby on RailsのActive Recordにおいて、大量のレコードをバッチ処理する際に使用されるメソッドです。このメソッドは、全てのレコードを一度にメモリにロードするのではなく、小さなグループ（デフォルトでは1000レコードずつ）に分けてイテレート（繰り返し処理）することで、メモリの消費を抑えることができます。

### **基本的な使い方**

**`find_each`** メソッドは、モデルのクラスメソッドとして提供されています。例えば、Userモデルの全ユーザーを処理するには、以下のように書きます。

```ruby
rubyCopy code
User.find_each do |user|
  # ここで各ユーザーに対する処理を行う
end

```

### **オプション**

- **`:batch_size`**：一度にロードするレコードの数を指定します。デフォルトは1000です。
- **`:start`**：指定したIDから処理を開始します。
- **`:finish`**：指定したIDで処理を終了します。

例えば、バッチサイズを500に設定するには、以下のようにします。

```ruby
rubyCopy code
User.find_each(batch_size: 500) do |user|
  # 処理
end

```

### **find_each vs. each**

大量のレコードを扱う場合、**`each`** メソッドではなく **`find_each`** を使用することが推奨されます。**`each`** メソッドを使用すると、処理対象の全レコードが一度にメモリにロードされるため、大量のレコードを扱う際にはメモリオーバーヘッドが大きくなります。一方で、**`find_each`** を使用すると、バッチサイズごとにレコードがロードされるため、メモリの使用量を抑えることができます。

### **使用上の注意**

- **`find_each`** はデフォルトでIDの昇順でレコードを処理します。そのため、IDでの順序付けが問題になる場合は注意が必要です。
- **`find_each`** 内でレコードの削除や追加を行うと、予期しない結果になる可能性があります。これは、処理中のレコードセットが変更されるためです。

**`find_each`** は、大量のデータを扱う際のパフォーマンス改善に役立つ強力なツールです。メモリの消費を抑えつつ、効率的にレコードを処理することができます。

・find_each
大量のデータを一度に取得して決まった単位（デフォルト1,000件)ごとに取得してループしてくれる機能。データを分割して取得することで少ないメモリで処理することができる。
find: 全データをメモリに展開してから処理
find_each: 少しずつデータをメモリに展開しつつ処理

・&:
配列(find_eachやmap、select、pluckなど)の中身を受け取るようなメソッドで使用することができる。