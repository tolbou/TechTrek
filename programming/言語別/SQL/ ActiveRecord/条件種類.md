## 条件種類

ActiveRecordにおけるクエリ条件の指定方法には複数のアプローチがあり、その中でも文字列ベースの条件指定は、SQLに近い形で条件を指定したい場合に使用されます。以下、文字列ベースの条件から順に説明します。

### 文字列ベースの条件

```ruby

.where("length >= 100 AND rating = 'PG'")

```

- 用途: SQLの`WHERE`句に近い形で、直接的な条件式を記述します。特定のカラムに対する比較演算子（`>=`, `<`, `<>`など）を用いる場合や、複数の条件を`AND`、`OR`で結合する必要がある場合に適しています。
- 特徴: SQLクエリに直接近いため、複雑な条件も柔軟に記述できます。しかし、ユーザー入力を含む場合はSQLインジェクションのリスクがあるため、プレースホルダーを使用して安全に値を渡す必要があります。

### プレースホルダーを使用した文字列ベースの条件

```ruby

.where("length >= ? AND rating = ?", 100, "PG")

```

- 用途: 外部からの入力を含む条件を安全に指定します。プレースホルダー（`?`）を使用して、直接文字列結合を避け、後から値をバインドします。
- 特徴: SQLインジェクション攻撃を防ぐことができる安全な方法です。条件式内の`?`はメソッド呼び出しの追加引数によって順に置き換えられます。

### ハッシュベースの条件

```ruby

.where(length: 100, rating: "PG")

```

- 用途: カラム名と値のペアをハッシュとして渡し、シンプルな等価性（`=`）の条件を指定します。関連テーブルの条件指定や、複数の条件を簡単に組み合わせたい場合に便利です。
- 特徴: 読みやすく、記述しやすい方法です。SQLインジェクションのリスクを自動的に軽減しますが、比較演算子や複雑なロジックを直接表現することはできません。

### 範囲オブジェクトを使用した条件

```ruby

.where(length: 100..200)

```

- 用途: 指定したカラムが特定の範囲内にあるレコードを検索します。主に数値や日付の範囲検索に使用されます。
- 特徴: 範囲オブジェクト（`Range`）を使用することで、`BETWEEN`クエリを簡潔に表現できます。

### Arelを使用した条件（高度）

Arelは、ActiveRecordの下層にある、より高度なクエリ構築エンジンです。Arelを使用することで、ActiveRecordだけでは表現が難しい複雑なクエリや条件を構築することが可能になります。Arelは直接的なActiveRecordのメソッドではありませんが、ActiveRecordのクエリ構築能力を拡張するために利用できます。

```ruby

users = User.arel_table
User.where(users[:name].matches("%#{name}%"))

```

この方法では、SQLの`LIKE`クエリに相当する検索を実行できます。Arelを使用すると、複雑な結合、サブクエリ、条件式などを細かく制御することができますが、ArelのAPIはActiveRecordのそれとは異なるため、学習コストが伴います。

これらの方法を適切に使い分けることで、アプリケーションの要件に応じた効率的かつ安全なデータアクセスが可能になります。