### SUMメソッド

**`sum`**メソッドはActiveRecordにおける集計関数の一つで、指定されたカラムの合計値を計算します。このメソッドは、特定のカラムに含まれる数値の合計を求める場合に非常に便利です。**`sum`**メソッドは、データベースレベルで合計値の計算を行うため、大量のデータがあっても高速に結果を得ることができます。

### **基本的な使い方**

**`Model.sum(:column_name)`**の形式で使用します。ここで、**`Model`**は対象のモデルクラス、**`:column_name`**は合計を計算したいカラムのシンボルです。

例えば、**`Order`**モデルがあり、すべての注文の合計金額を計算したい場合は以下のようにします：

```ruby
rubyCopy code
total_amount = Order.sum(:amount)

```

このコードは**`orders`**テーブルの**`amount`**カラムに含まれる全ての値の合計を計算します。

### **条件を指定する**

**`sum`**メソッドは、**`where`**などの他のクエリメソッドとチェーンして使用することができます。特定の条件を満たすレコードに限定して合計値を計算したい場合に便利です。

例えば、2023年の注文に限定して合計金額を計算する場合は以下のようになります：

```ruby
rubyCopy code
total_amount_2023 = Order.where("created_at >= ? AND created_at <= ?", Time.new(2023).beginning_of_year, Time.new(2023).end_of_year).sum(:amount)

```

### **グループ化して合計を計算する**

**`group`**メソッドと組み合わせることで、特定のカラムでグループ化した上での合計値を計算することができます。これにより、カテゴリーごとの売上合計など、より詳細な分析が可能になります。

例えば、注文を**`category_id`**ごとにグループ化し、各カテゴリーの合計金額を計算する場合は以下のようになります：

```ruby
rubyCopy code
total_amount_by_category = Order.group(:category_id).sum(:amount)

```

このコードは、各**`category_id`**ごとの**`amount`**の合計値を含むハッシュを返します。

### **注意点**

- **`sum`**メソッドはSQLの**`SUM`**関数を使用してデータベースレベルで計算を行うため、大量のレコードがある場合でも効率的に合計値を求めることができます。
- カラムにNULL値が含まれる場合、それらの値は合計計算時に無視されます（0として扱われます）。

ActiveRecordの**`sum`**メソッドを使用することで、複雑なSQLクエリを書くことなく、Rubyのコードだけで直感的かつ効率的に合計値の計算を行うことができます。